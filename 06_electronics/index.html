<!DOCTYPE html>
<html lang="en">

<title>PS70: Introduction to Digital Fabrication </title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="../style.css" rel="stylesheet">


<nav class="navbar navbar-expand-sm navbar-light bg-light">
  <div style="align-items: left; justify-content:left;" class="container-fluid">
    <h3 class="nav-title"> PS70: Intro to Digital Fabrication</h3>
    <div class="navbar-nav">
      <h4></h4>
      <h4><a class="nav-link" href="../index.html">Home</a></h4>
      <h4><a class="nav-link" href="../about.html">About</a></h4>
<h4><a class="nav-link" href="./01_intro/index.html">Final Project</a></h4>
    </div>
  </div>
</nav>

<body>


<xmp style="display:none;">
<br> 

#### Week 6: Electronic Input Devices 

Because it is difficult to be able to practice my piano during the day (due to my toddler son insisting that I either stop and play with him, or that he be the one playing the piano), I recently had the QuietTime ProRecord module added to my acoustic grand piano. Through a series of infra red leds tucked underneath the keybed, it is possible to read the velocity of the key strikes. From these data, MIDI (musical instrument digital interface) messages can be sent out. This video was very helpful:

 <iframe width="560" height="315" src="https://www.youtube.com/embed/GxfHijjn0ZM?si=Q7P259rDan8Gae88" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

I used the arduino uno to behave as an input, receiving the MIDI out messages that get sent out from the piano. 

This is what the schematic looks like for the MIDI input circuit:

<img src="../images/schematicmidiin.png" alt="schematic midi in" width="400" height="237">

I needed to use an 6n138 optocoupler chip. Inside of this little chip there is an infrared LED that flashes on one side and is read on the other side. That is how it communicates the bits in the information flow. Pin 8 on the chip connects to the positive and pin 5 to ground. 

The Midi jack has 5 pin connections; I connected to pins 4 and 5 to transmit the Midi note messages.

On the coding end, I needed to use the Arduino MIDI Library. The easiest way of seeing if I was receiving the MIDI data, was to have the built in LED on pin 13, which looks like this:

<code>#include Servo.h

int x=30; //TEMPO <br>
float m=60/x*1000; <br>
float qn=m/4; //quarter note<br>
float en=m/8; //eighth note<br>
float sn=m/16; //sixteenth note<br>
float tsn=m/32; //thirty secondth note<br>

float den=m/16*3; //dotted sixteenth note<br>
int servoPin=4;<br>
int servoU=45;<br>
int servoD=0;<br>
Servo myServo;<br>

void setup() {<br>
  // put your setup code here, to run once:<br>
  Serial.begin(9600);<br>
myServo.attach(servoPin);<br>
}<br>
<br>
void loop() {<br>
  // put your main code here, to run repeatedly:<br>
<br>
myServo.write(servoD);<br>
delay(sn);<br>
myServo.write(servoU);<br>
delay(en);<br>
myServo.write(servoD);<br>
delay(sn);<br>
myServo.write(servoU);<br>
delay(den);<br>
myServo.write(servoD);<br>
delay(sn);<br>
myServo.write(servoU);<br>
delay(en);<br>
myServo.write(servoD);<br>
delay(sn);<br>
myServo.write(servoU);<br>
delay(sn);<br>
myServo.write(servoD);<br>
delay(sn);<br>
myServo.write(servoU);<br>
delay(den);<br>
}</code>




<img src="../images/insidepiano.jpg" alt="inside the piano" width="335" height="251">

<img src="../images/pianopedals.jpg"
alt="piano pedals" width="334" height="251">



</xmp>
</body>

<script src="../strapdown.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" ></script>

</html>